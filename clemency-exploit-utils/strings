#!/usr/bin/python
import sys
import string

import clemency.struct as struct

THRESHOLD = 3

if '-n' in sys.argv:
  idx = sys.argv.index('-n')
  THRESHOLD = int(sys.argv[idx+1])
  del sys.argv[idx+1]
  del sys.argv[idx]

NULL_TERMINATED_ONLY = False
if '--nto' in sys.argv:
  NULL_TERMINATED_ONLY = True
  idx = sys.argv.index('--nto')
  del sys.argv[idx]

if len(sys.argv) > 1:
  f = struct.ClemencyFile(open(sys.argv[1], 'r'))
else:
  f = struct.ClemencyFile(sys.stdin)

ps = map(ord, string.printable)

buf = f.read_all()
pos = 0
while pos < len(buf):
  printable_len = 0
  if buf[pos] == 0:
    pos = pos+1
    continue
  if buf[pos] in ps:
    printable_len = 1
    while ((pos+printable_len) < len(buf)) and buf[pos+printable_len] in ps:
      printable_len += 1
  else:
    pos += 1
    continue
  if (printable_len-1) > THRESHOLD and ((not NULL_TERMINATED_ONLY) or (pos+printable_len >= len(buf) or buf[pos+printable_len] == 0)):
    print buf[pos:min(pos+printable_len, len(buf))].to_printable_string().strip('\n')
  pos += printable_len
